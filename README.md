guppy-runner
============

## Setup

You must have the following installed:
- [nix](https://nixos.org/download.html)
- [poetry](https://python-poetry.org/docs/#installation)
- [cargo](https://doc.rust-lang.org/cargo/getting-started/installation.html)
- [just](https://github.com/casey/just)
- [cmake](https://cmake.org/download/)

This repository uses git submodules to include the `hugr-mlir` and `qir-runner` projects. Make sure to run `git submodule init` after cloning this repository to initialize them.

Run the following commands to install the dependencies.
This will build the `hugr-mlir` and `qir-runner` projects, so it may take a while.

```bash
just install
just run --help
```

### Advanced setup

If not using `just`, you must configure all the environment variables manually.

You must have compiled `hugr-mlir-translate` and `hugr-mlir-opt` from the [`hugr-mlir`](https://github.com/CQCL/hugr-mlir). If these are not found in your path, you can set the `HUGR_MLIR_TRANSLATE` and `HUGR_MLIR_OPT` environment variables.

Your path must contain `mlir-translate`, `llc`, and `clang` from the LLVM project.
See [here](https://mlir.llvm.org/getting_started/) for instructions.
Note that this should be the same version used to compile `hugr-mlir`.
You can override the default paths by setting the `MLIR_TRANSLATE`, `LLC`, and `CLANG` environment variables.

You also need to compile the `qir_backend` libraries from [`qir-runner`](https://github.com/qir-alliance/qir-runner) and set the appropriated path in the `QIR_BACKEND_LIBS` environment variable.

The `.env` file points to the build artifacts for these projects generated by `just`.

## Usage

Run your program from the command line,
```bash
just run guppy_program.py
```

See `just run --help` for more options.

The runner can also be used as a library, if all the environment variables are
set correctly.

```python
from guppy_runner import run_guppy

run_guppy("guppy.py")
```

## License

This project is licensed under Apache License, Version 2.0 ([LICENSE][] or http://www.apache.org/licenses/LICENSE-2.0).

  [LICENSE]: ./LICENSE
